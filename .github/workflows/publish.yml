name: Update plugins

on:
  push:
    branches:
      - master

jobs:
  notify-manager:
    runs-on: ubuntu-latest
    environment: notify

    steps:
      - name: Send update webhook
        env:
          SERVER_HOST: ${{ secrets.SERVER_HOST }}
          SECRET_TOKEN: ${{ secrets.SECRET_TOKEN }}
        run: |
          if [ -z "$SERVER_HOST" ] || [ -z "$SECRET_TOKEN" ]; then
            echo "SERVER_HOST and SECRET_TOKEN secrets must be set" >&2
            exit 1
          fi
          curl -sSf -X POST \
            -H "X-Secret-Token: ${SECRET_TOKEN}" \
            "https://${SERVER_HOST}/update"
